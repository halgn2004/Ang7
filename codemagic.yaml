workflows:
  ios-release:
    name: iOS Build & Publish
    integrations:
      app_store_connect: "anga7"   # نفس الاسم اللي اخترته عند إعداد التكامل
    environment:
      groups:
        - ios_code_signing
      vars:
        DOTNET_VERSION: "9.0.x"
        PROJECT_PATH: "Ang7.csproj"
    scripts:
      - name: Install .NET and MAUI
        script: |
          dotnet workload install maui ios
      - name: Restore dependencies
        script: dotnet restore $PROJECT_PATH
      - name: Build iOS
        script: |
          dotnet publish $PROJECT_PATH -f net9.0-ios -c Release \
            -p:RuntimeIdentifier=ios-arm64 \
            -p:PlatformTarget=arm64 \
            -o ./artifacts/ios/
    artifacts:
      - ./artifacts/ios/**/*.ipa
    publishing:
      app_store_connect:
        auth: integration
        submit_to_testflight: true
        submit_to_app_store: true
