<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" xmlns:xct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit" xmlns:d="http://schemas.microsoft.com/dotnet/2021/maui/design" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:helpers="clr-namespace:Ang7.Helpers"  xmlns:ffimage="clr-namespace:FFImageLoading.Maui;assembly=FFImageLoading.Compat.Maui" NavigationPage.HasNavigationBar="False" mc:Ignorable="d" x:Class="Ang7.Views.AL_HomePage" BackgroundColor="White">
    <ContentPage.Padding>
        <OnPlatform x:TypeArguments="Thickness">
            <On Platform="iOS" Value="0,0,0,-30" />
        </OnPlatform>
    </ContentPage.Padding>
    <Grid HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand" FlowDirection="RightToLeft" BackgroundColor="White">
        <ffimage:CachedImage Aspect="AspectFill" Source="{OnIdiom Phone='bg.png',Tablet='bg.png'}" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand" DownsampleToViewSize="True"/>
        <BoxView BackgroundColor="#A1A1A1" Opacity="0.9" />
        <SwipeView x:Name="MainSwipeView" BackgroundColor="Transparent"><!--FlowDirection="RightToLeft"-->
            <SwipeView.RightItems>
                <SwipeItems>
                    <SwipeItemView>
                        <Grid>
                            <StackLayout Spacing="20" Padding="10,0" WidthRequest="200" BindableLayout.ItemsSource="{Binding MyMenu}" VerticalOptions="CenterAndExpand" FlowDirection="RightToLeft">
                                <BindableLayout.ItemTemplate>
                                    <DataTemplate>
                                        <StackLayout Orientation="Horizontal" Spacing="5">
                                            <StackLayout.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="MenuTapped" />
                                            </StackLayout.GestureRecognizers>
                                            <Grid HeightRequest="40" WidthRequest="40" VerticalOptions="Center" HorizontalOptions="Start" InputTransparent="false">
                                                <Border Grid.Row="0" BackgroundColor="#0F97ED" HeightRequest="30" WidthRequest="30" StrokeShape="RoundRectangle 15,15,15,15" VerticalOptions="Center" HorizontalOptions="Center">
                                                    <ffimage:CachedImage Grid.Row="0" Source="{Binding Icon}" HeightRequest="20" WidthRequest="20" Margin="10" Aspect="AspectFit" VerticalOptions="Center" HorizontalOptions="Center" InputTransparent="True" DownsampleToViewSize="True" />
                                                </Border>
                                            </Grid>
                                            <Label Text="{Binding Name}" InputTransparent="True" TextColor="White" FontSize="12" FontAttributes="Bold" HorizontalOptions="Start" VerticalOptions="Center" Margin="1,0,0,0">
                                                <Label.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="MenuTapped" />
                                                </Label.GestureRecognizers>
                                            </Label>
                                        </StackLayout>
                                    </DataTemplate>
                                </BindableLayout.ItemTemplate>
                            </StackLayout>
                        </Grid>
                    </SwipeItemView>
                </SwipeItems>
            </SwipeView.RightItems>
            <Border x:Name="pancake" Margin="0" Padding="0" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand" BackgroundColor="White">
                <Grid x:Name="swipeContent" RowDefinitions="Auto,*">
                    <!-- Header -->
                    <Grid Grid.Row="0" ColumnDefinitions="Auto,Auto,*,Auto" BackgroundColor="White" HorizontalOptions="FillAndExpand" HeightRequest="45" FlowDirection="RightToLeft" Margin="15,0" ColumnSpacing="0">
                        <ffimage:CachedImage Grid.Column="0" Source="mi_menu.png" HeightRequest="18" HorizontalOptions="Start" VerticalOptions="Center">
                            <ffimage:CachedImage.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OpenSwipe" />
                            </ffimage:CachedImage.GestureRecognizers>
                        </ffimage:CachedImage>
                        <ffimage:CachedImage Grid.Column="1" Source="search.png" HeightRequest="20" WidthRequest="20" Margin="10,0,0,0" HorizontalOptions="Start" VerticalOptions="Center" IsVisible="{Binding IsSearchMode,Converter={StaticResource inverter}}">
                            <ffimage:CachedImage.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding OpenSearchBarCommand}" />
                            </ffimage:CachedImage.GestureRecognizers>
                        </ffimage:CachedImage>
                        <Grid RowDefinitions="Auto" Grid.Column="1" Grid.ColumnSpan="2" ColumnDefinitions="*,40" Margin="0,0,0,0" IsVisible="{Binding IsSearchIcon}" VerticalOptions="Center">
                            <SearchBar x:Name="searchBar" BackgroundColor="White" Placeholder="أبحث عن" HorizontalTextAlignment="Start" FontSize="Small" HorizontalOptions="FillAndExpand" IsVisible="{Binding IsSearchMode}" TextChanged="searchBar_TextChanged" Grid.Column="0" />
                            <ffimage:CachedImage Grid.Column="1" Source="back.png" HeightRequest="40" BackgroundColor="Transparent" HorizontalOptions="End" VerticalOptions="Center" IsVisible="{Binding IsSearchMode}">
                                <ffimage:CachedImage.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="CloseSB" />
                                </ffimage:CachedImage.GestureRecognizers>
                            </ffimage:CachedImage>
                        </Grid>
                        <Label Grid.Column="2" Margin="0,4,8,0" FontFamily="FontMontserratBold" FontSize="24" Text="محاضرينا" HorizontalOptions="Center" VerticalOptions="Center" IsVisible="{Binding IsSearchMode , Converter={StaticResource inverter}}" />
                        <StackLayout Grid.Column="3" HorizontalOptions="EndAndExpand" Orientation="Horizontal" VerticalOptions="Center" Spacing="5" FlowDirection="LeftToRight" Margin="10,0">
                            <ffimage:CachedImage Rotation="{Binding RefreshImgRotation}" Aspect="AspectFit" HeightRequest="32" Source="refresh.png" WidthRequest="32" HorizontalOptions="EndAndExpand">
                                <ffimage:CachedImage.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding RefreshCommand}" />
                                </ffimage:CachedImage.GestureRecognizers>
                            </ffimage:CachedImage>
                            <ffimage:CachedImage Source="message.png" BackgroundColor="Transparent" FlexLayout.AlignSelf="Center" FlexLayout.Grow="1" Aspect="AspectFit" HeightRequest="32" WidthRequest="32" HorizontalOptions="Start" IsVisible="{Binding Isfbmsg}">
                                <ffimage:CachedImage.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding OnMessageButtonClickedCommand}" />
                                </ffimage:CachedImage.GestureRecognizers>
                            </ffimage:CachedImage>
                        </StackLayout>
                    </Grid>
                    <!-- Empty -->
                    <Grid x:Name="empty" Grid.Row="1" BackgroundColor="White" IsVisible="{Binding IsEmpty}" HorizontalOptions="FillAndExpand" VerticalOptions="FillAndExpand">
                        <ffimage:CachedImage Source="empty.png" WidthRequest="40" HeightRequest="40" Margin="0,0,0,100" HorizontalOptions="CenterAndExpand" VerticalOptions="CenterAndExpand" DownsampleToViewSize="True" />
                        <Label Text="لا يوجد محاضرين حاليا" HorizontalOptions="CenterAndExpand" VerticalOptions="CenterAndExpand" />
                    </Grid>
                    <!-- Main Grid-->
                    <StackLayout Grid.Row="1" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand" IsVisible="{Binding IsSearchMode, Converter={StaticResource inverter}}" Padding="10" BackgroundColor="White">
                        <ScrollView VerticalOptions="FillAndExpand">
                            <CollectionView x:Name="listTeachers" Margin="0,15,0,0" ItemsSource="{Binding Teachers}" VerticalScrollBarVisibility="Never">
                                <CollectionView.ItemsLayout>
                                    <GridItemsLayout Orientation="Vertical" Span="2" VerticalItemSpacing="15" />
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="10,0">
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Path=BindingContext.NavigateToDetailPageCommand, Source={RelativeSource AncestorType={x:Type CollectionView}}}" CommandParameter="{Binding .}" NumberOfTapsRequired="1" />
                                            </Grid.GestureRecognizers>
                                            <Border Padding="0,0,0,10" BackgroundColor="{StaticResource colorGrayF6}" StrokeShape="RoundRectangle 12,12,12,12" InputTransparent="True">
                                                <Grid RowDefinitions="auto, auto, auto, auto" RowSpacing="0">
                                                    <ffimage:CachedImage Grid.Row="0" Margin="0,25,0,0" Aspect="AspectFit" HeightRequest="120" Source="{Binding PP}" InputTransparent="True" />
                                                    <Label Grid.Row="1" Margin="10,0" FontFamily="FontMontserratSemiBold" FontSize="{Binding NameFontSize}" HorizontalTextAlignment="Center" LineBreakMode="TailTruncation" Text="{Binding Name}" InputTransparent="True" />
                                                    <BoxView Grid.Row="2" Margin="0,10,0,5" BackgroundColor="{StaticResource colorGrayEA}" HeightRequest="1" HorizontalOptions="FillAndExpand" InputTransparent="True" />
                                                    <StackLayout Grid.Row="3" HorizontalOptions="Center" Orientation="Horizontal" InputTransparent="True">
                                                        <CollectionView ItemsSource="{Binding Subjects}" VerticalScrollBarVisibility="Never" HeightRequest="{Binding SubjectsHeight}" InputTransparent="True">
                                                            <CollectionView.ItemsLayout>
                                                                <GridItemsLayout Orientation="Vertical" Span="1" VerticalItemSpacing="3" />
                                                            </CollectionView.ItemsLayout>
                                                            <CollectionView.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackLayout Orientation="Horizontal" Margin="0,2" Padding="10,0" InputTransparent="True">
                                                                        <Border Grid.Row="0" BackgroundColor="#0F97ED" HeightRequest="30" WidthRequest="30" StrokeShape="RoundRectangle 15,15,15,15" VerticalOptions="Center" HorizontalOptions="Center">
                                                                            <ffimage:CachedImage Grid.Row="0" Source="subject.png" HeightRequest="25" WidthRequest="25" Margin="10" Aspect="AspectFit" VerticalOptions="Center" HorizontalOptions="Center" InputTransparent="True" DownsampleToViewSize="True" />
                                                                        </Border>
                                                                        <Label Text="{Binding .}" TextColor="black" FontSize="15" HorizontalOptions="Start" VerticalOptions="Center" Margin="5,0,0,0" />
                                                                    </StackLayout>
                                                                </DataTemplate>
                                                            </CollectionView.ItemTemplate>
                                                        </CollectionView>
                                                    </StackLayout>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </ScrollView>
                    </StackLayout>
                    <!--<StackLayout Grid.Row="1" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand" IsVisible="{Binding IsSearchMode, Converter={StaticResource inverter}}" Padding="10" BackgroundColor="White">

                        <CollectionView x:Name="listTeachers" Margin="0,15,0,0" ItemsSource="{Binding Teachers}">
                            <CollectionView.ItemsLayout>
                                <GridItemsLayout Orientation="Vertical" Span="2" VerticalItemSpacing="15" />
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="10,0">
                                        <Grid.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Path=BindingContext.NavigateToDetailPageCommand, Source={RelativeSource AncestorType={x:Type CollectionView}}}" CommandParameter="{Binding .}" NumberOfTapsRequired="1" />
                                        </Grid.GestureRecognizers>
                                        <Border Padding="0,0,0,10" BackgroundColor="{StaticResource colorGrayF6}" StrokeShape="RoundRectangle 12,12,12,12" InputTransparent="True">
                                            <Grid RowDefinitions="auto, auto, auto, auto" RowSpacing="0">
                                                <ffimage:CachedImage Grid.Row="0" Margin="0,25,0,0" Aspect="AspectFit" HeightRequest="120" Source="{Binding PP}" InputTransparent="True" />
                                                <Label Grid.Row="1" Margin="10,0" FontFamily="FontMontserratSemiBold" FontSize="{Binding NameFontSize}" HorizontalTextAlignment="Center" LineBreakMode="TailTruncation" Text="{Binding Name}" InputTransparent="True" />
                                                <BoxView Grid.Row="2" Margin="0,10,0,5" BackgroundColor="{StaticResource colorGrayEA}" HeightRequest="1" HorizontalOptions="FillAndExpand" InputTransparent="True" />
                                                <StackLayout Grid.Row="3" HorizontalOptions="Center" Orientation="Horizontal" InputTransparent="True">
                                                    <CollectionView ItemsSource="{Binding Subjects}" VerticalScrollBarVisibility="Never" HeightRequest="{Binding SubjectsHeight}" InputTransparent="True">
                                                        <CollectionView.ItemsLayout>
                                                            <GridItemsLayout Orientation="Vertical" Span="1" VerticalItemSpacing="3" />
                                                        </CollectionView.ItemsLayout>
                                                        <CollectionView.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackLayout Orientation="Horizontal" Margin="0,2" Padding="10,0" InputTransparent="True">
                                                                    <Border Grid.Row="0" BackgroundColor="#0F97ED" HeightRequest="30" WidthRequest="30" StrokeShape="RoundRectangle 15,15,15,15" VerticalOptions="Center" HorizontalOptions="Center">
                                                                        <ffimage:CachedImage Grid.Row="0" Source="subject.png" HeightRequest="25" WidthRequest="25" Margin="10" Aspect="AspectFit" VerticalOptions="Center" HorizontalOptions="Center" InputTransparent="True" DownsampleToViewSize="True" />
                                                                    </Border>
                                                                    <Label Text="{Binding .}" TextColor="black" FontSize="15" HorizontalOptions="Start" VerticalOptions="Center" Margin="5,0,0,0" />
                                                                </StackLayout>
                                                            </DataTemplate>
                                                        </CollectionView.ItemTemplate>
                                                    </CollectionView>
                                                </StackLayout>
                                            </Grid>
                                        </Border>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </StackLayout>-->

                    <!-- search -->
                    <StackLayout Grid.Row="1" VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand" IsVisible="{Binding IsSearchMode}" Padding="10" BackgroundColor="white">
                        <ScrollView VerticalOptions="FillAndExpand">
                            <CollectionView x:Name="listsTeachers" Margin="0,15,0,0" ItemsSource="{Binding SearchTeachers}" IsVisible="{Binding IsAnySearchRes}">
                                <!---VerticalScrollBarVisibility="Never" -->
                                <CollectionView.ItemsLayout>
                                    <GridItemsLayout Orientation="Vertical" Span="2" VerticalItemSpacing="15" />
                                </CollectionView.ItemsLayout>
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="10,0">
                                            <Grid.GestureRecognizers>
                                                <TapGestureRecognizer Command="{Binding Path=BindingContext.NavigateToDetailPageCommand, Source={RelativeSource AncestorType={x:Type CollectionView}}}" CommandParameter="{Binding .}" NumberOfTapsRequired="1" />
                                            </Grid.GestureRecognizers>
                                            <Border Padding="0,0,0,10" BackgroundColor="{StaticResource colorGrayF6}" StrokeShape="RoundRectangle 12,12,12,12" InputTransparent="True">
                                                <Grid RowDefinitions="auto, auto, auto, auto" RowSpacing="0">
                                                    <ffimage:CachedImage Grid.Row="0" Margin="0,25,0,0" Aspect="AspectFit" HeightRequest="120" Source="{Binding PP}" InputTransparent="True" />
                                                    <Label Grid.Row="1" Margin="10,0" FontFamily="FontMontserratSemiBold" FontSize="{Binding NameFontSize}" HorizontalTextAlignment="Center" LineBreakMode="TailTruncation" Text="{Binding Name}" InputTransparent="True" />
                                                    <BoxView Grid.Row="2" Margin="0,10,0,5" BackgroundColor="{StaticResource colorGrayEA}" HeightRequest="1" HorizontalOptions="FillAndExpand" InputTransparent="True" />
                                                    <StackLayout Grid.Row="3" HorizontalOptions="Center" Orientation="Horizontal" InputTransparent="True">
                                                        <CollectionView ItemsSource="{Binding Subjects}" VerticalScrollBarVisibility="Never" HeightRequest="{Binding SubjectsHeight}" InputTransparent="True">
                                                            <CollectionView.ItemsLayout>
                                                                <GridItemsLayout Orientation="Vertical" Span="1" VerticalItemSpacing="3" />
                                                            </CollectionView.ItemsLayout>
                                                            <CollectionView.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackLayout Orientation="Horizontal" Margin="0,2" Padding="10,0" InputTransparent="True" FlowDirection="RightToLeft">
                                                                        <Border Grid.Row="0" BackgroundColor="#0F97ED" HeightRequest="30" WidthRequest="30" StrokeShape="RoundRectangle 15,15,15,15" VerticalOptions="Center" HorizontalOptions="Center">
                                                                            <ffimage:CachedImage Grid.Row="0" Source="subject.png" HeightRequest="25" WidthRequest="25" Margin="10" Aspect="AspectFit" VerticalOptions="Center" HorizontalOptions="Center" InputTransparent="True" DownsampleToViewSize="True" />
                                                                        </Border>
                                                                        <Label Text="{Binding .}" TextColor="black" FontSize="15" HorizontalOptions="Start" VerticalOptions="Center" Margin="5,0,0,0" />
                                                                    </StackLayout>
                                                                </DataTemplate>
                                                            </CollectionView.ItemTemplate>
                                                        </CollectionView>
                                                    </StackLayout>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </ScrollView>
                        <!-- Label for No Results -->
                        <Label HorizontalOptions="Center" VerticalOptions="StartAndExpand" Margin="0,-100,0,0" Text="لم يتم العثور علي اي نتيجة." HorizontalTextAlignment="Center" VerticalTextAlignment="Center" FontSize="Large" TextColor="{StaticResource colorRedFF}" IsVisible="{Binding IsAnySearchRes, Converter={StaticResource inverter}}" />
                    </StackLayout>


                </Grid>
            </Border>
        </SwipeView>
    </Grid>
</ContentPage>